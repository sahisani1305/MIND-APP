<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow-x: hidden;
            height: 100vh;
            min-height: 100vh; /* Ensure body height covers the full viewport */
            display: flex;
            flex-direction: column;
        }

        /* Background Styles */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #83a4d4, #b6fbff);
            z-index: -1;
        }

        .content {
            margin-left: 50px;
            padding: 20px;
            transition: all 0.3s ease;
            flex: 1;
        }

        /* Side Panel Styles */
        .side-panel {
            width: 40px;
            background-color: rgb(70, 118, 191);
            color: white;
            position: fixed;
            top: 0;
            bottom: 0; /* Ensures the panel covers full height */
            left: 0;
            z-index: 1502;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .side-panel.open {
            width: 250px;
        }

        .side-panel .toggle-btn {
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .side-panel .user-info {
            display: none;
            padding: 10px;
            text-align: center;
        }

        .side-panel.open .user-info {
            display: block;
        }

        .side-panel .user-info img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .side-panel .user-info h2,
        .side-panel .user-info p {
            margin: 0;
            padding: 0;
        }

        .side-panel .menu {
            padding: 10px;
            border-top: 1px solid white;
            display: none;
        }

        .side-panel.open .menu {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .side-panel .menu a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 10px;
            text-align: center;
        }

        .side-panel .menu a:hover {
            background-color: rgb(35, 42, 52);
        }

        /* Dashboard Grid Layout */
        .dashboard-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            padding: 20px;
            height: 60vh;
            box-sizing: border-box;
        }

        
        /* Overlay and Blur Effect */
        .content-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1501;
        }
        
        .content-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Left Column containing Calendar and Chart */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: calc(60vh - 40px);
        }
        
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: calc(60vh - 40px);
        }
        
        /* Individual Containers */
        .calendar-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 200px;
        }
        
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 370px;
        }
        
        .line-graph-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 270px;
        }
        
        .recommendations-container {
            grid-column: 2;
            grid-row: 3;
            background-color: white;
            padding: 12px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(100%);
            animation: slideInBottom 0.5s ease-out 0.4s forwards;
            overflow-y: auto;
            min-height: 300px; /* Minimum height */
        }
        
        /* Responsive Layout */
        @media (min-width: 481px) and (max-width: 1024px) {
            .dashboard-layout {
                grid-template-columns: 240px 1fr;
                grid-template-rows: repeat(2,auto);
                height: auto;
            }
            .chart-container{
                height: auto;
                width: auto;
            }
            .line-graph-container{
                height: auto;
                width: auto;
            }
            .recommendations-container {
                height: auto;
                margin-bottom: 20px;
            }
            .calendar-container{
                width: auto;
                height: auto;
            }
            .left-column {
                display: flex;
                flex-direction: column;
                gap: 20px;
                height: auto;
            }
            
            .right-column {
                display: flex;
                flex-direction: column;
                gap: 20px;
                height: auto;
            }
        
            .content {
                margin-left: auto;
                margin-right: 0;
                padding: 10px;
                width: 90%;
            }
            .recommendations-container #recommendationContent {
                height: auto;
                max-height: 300px;
                overflow-y: auto;
            }
            .greeting-container {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 2px;
                font-size: 0.6em;
            }
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
            }
            
            /* Chat icon styling */
            .chat-icon {
                position: fixed;
                bottom: 24px;
                right: 24px;
                width: 60px;
                height: 60px;
                background-color: #0066ff;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                color: #fff;
                font-size: 24px;
                box-shadow: 0 4px 12px rgba(0, 102, 255, 0.2);
                transition: all 0.3s ease;
                z-index: 1000;
            }
            
            .chat-icon:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 16px rgba(0, 102, 255, 0.3);
            }
            
            .notification-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background-color: #ff3b30;
                color: white;
                border-radius: 50%;
                padding: 4px 8px;
                font-size: 12px;
                display: none;
            }
            
            /* Overlay styling */
            .overl {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: none;
                z-index: 1500;
            }
            
            /* Chat container styling */
            .chat-container {
                position: fixed;
                bottom: 96px;
                right: 24px;
                width: 360px;
                height: 480px;
                background-color: #ffffff;
                border-radius: 16px;
                display: none;
                flex-direction: column;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
                transition: all 0.3s ease;
                z-index: 2000;
            }
            
            .chat-header {
                background-color: #0066ff;
                color: #fff;
                padding: 16px;
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
            }
            
            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .header-title {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .bot-avatar {
                font-size: 20px;
            }
            
            .title-text {
                font-weight: 600;
                font-size: 16px;
            }
            
            .close-btn {
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                opacity: 0.8;
                transition: opacity 0.2s ease;
            }
            
            .close-btn:hover {
                opacity: 1;
            }
            
            .header-status {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 12px;
                margin-top: 4px;
            }
            
            .status-indicator {
                width: 8px;
                height: 8px;
                background-color: #4cd964;
                border-radius: 50%;
            }
            
            /* Messages container */
            .messages-container {
                flex-grow: 1;
                overflow-y: auto;
                padding: 16px;
                background-color: #f8f9fa;
                scrollbar-width: thin;
                scrollbar-color: #ccd0d5 #f8f9fa;
                position: relative;
            }
            
            .messages-container::-webkit-scrollbar {
                width: 6px;
            }
            
            .messages-container::-webkit-scrollbar-track {
                background: #f8f9fa;
            }
            
            .messages-container::-webkit-scrollbar-thumb {
                background-color: #ccd0d5;
                border-radius: 3px;
            }
            
            /* Message styling */
            .message {
                padding: 12px 16px;
                border-radius: 16px;
                margin-bottom: 12px;
                max-width: 80%;
                word-wrap: break-word;
                animation: messageAppear 0.3s ease;
            }
            
            .message.user {
                background-color: #0066ff;
                color: #ffffff;
                margin-left: auto;
                border-bottom-right-radius: 4px;
            }
            
            .message.bot {
                background-color: #f0f2f5;
                color: #1c1e21;
                margin-right: auto;
                border-bottom-left-radius: 4px;
            }
            
            @keyframes messageAppear {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            /* Typing indicator */
            .typing-indicator {
                display: none;
                padding: 12px 16px;
                background-color: #f0f2f5;
                border-radius: 16px;
                width: fit-content;
                margin-bottom: 12px; /* Add margin to position it below the user's message */
                margin-left: 0; /* Align to the right for bot responses */
                margin-right: auto; /* Align to the right for bot responses */
            }
            
            .typing-indicator span {
                width: 8px;
                height: 8px;
                background-color: #90949c;
                border-radius: 50%;
                display: inline-block;
                margin: 0 2px;
                animation: typing 1s infinite ease-in-out;
            }
            
            .typing-indicator span:nth-child(2) {
                animation-delay: 0.2s;
            }
            
            .typing-indicator span:nth-child(3) {
                animation-delay: 0.4s;
            }
            
            @keyframes typing {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-4px); }
            }
            
            /* Input area styling */
            .input-area {
                padding: 16px;
                background-color: #ffffff;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                border-top: 1px solid #eaecef;
            }
            
            .input-container {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .input-wrapper {
                flex-grow: 1;
                display: flex;
                align-items: center;
                background-color: #f0f2f5;
                border-radius: 24px;
                padding: 8px 16px;
            }
            
            #user-input {
                flex-grow: 1;
                border: none;
                background: none;
                outline: none;
                padding: 8px 0;
                font-size: 14px;
            }
            
            #send-button {
                background-color: #0066ff;
                border: none;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s ease;
                margin-left: 8px;
            }
            
            #send-button:hover {
                background-color: #0052cc;
            }
            
            .send-icon {
                width: 20px;
                height: 20px;
                filter: brightness(0) invert(1);
            }
            
            /* Dropdown styling */
            .dropdown-container {
                position: relative;
            }
            
            .dropdown-btn {
                background-color: #f0f2f5;
                border: none;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            
            .dropdown-btn:hover {
                background-color: #e4e6eb;
            }
            
            .dots {
                color: #65676b;
                font-size: 24px;
                line-height: 0;
            }
            
            .dropdown-content {
                position: absolute;
                bottom: 100%;
                right: 0;
                margin-bottom: 8px;
                background-color: #ffffff;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                display: none;
                min-width: 180px;
            }
            
            .dropdown-item {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 12px 16px;
                width: 100%;
                border: none;
                background: none;
                cursor: pointer;
                transition: background-color 0.2s ease;
                color: #1c1e21;
                font-size: 14px;
                text-align: left;
            }
            
            .dropdown-item:hover {
                background-color: #f0f2f5;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(2, 580px);
                padding: 10px;
            }
        
            .recommendations-container {
                width: auto;
                height: auto;
                overflow-y: auto;
                bottom-margin: 10px; /* Add margin to create gap */
            }
            .chart-container{
                height: auto;
                width: auto;
            }
            .line-graph-container{
                height: auto;
                width: auto;
            }
            #lineChart {
                height: auto;
                width: 100% !important;
            }
        
            .calendar-container {
                height: 400px;
                width: 320px;
                margin: 0 auto;
            }
            .content {
                margin-left: 35px;
                margin-right: 20px;
                padding: 10px;
                width: 100%;
            }
            .recommendations-container #recommendationContent {
                height: auto;
                max-height: 300px;
                overflow-y: auto;
            }
            /* Calendar Styles */
            .calendar {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 2px;
                margin: 10px auto;
            }
            
            .day {
                width: 20px;
                height: 20px;
                line-height: 20px;
                text-align: center;
                border: 1px solid #ccc;
                border-radius: 50%;
                background-color: #f9f9f9;
                font-size: 0.7em;
                position: relative;
            }
            
            .day.active {
                background-color:rgb(255, 166, 0);
                color: black;
                z-index: 1;
                font-weight: bold;
            }
            
            .day.active::before {
                content: '🔥';
                font-size: 50px;
                position: absolute;
                top: 5px;
                left: 50%;
                transform: translateX(-50%);
                z-index: -1;
                animation: flame 1s infinite;
            }
            
            @keyframes flame {
                0%, 100% {
                    transform: translateX(-50%) translateY(0) scale(1);
                }
                50% {
                    transform: translateX(-50%) translateY(-3px) scale(1.1);
                }
            }
            .greeting-container {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 2px;
                margin-right: 8px;
                font-size: 0.6em;
            }
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
            }
            
            /* Chat icon styling */
            .chat-icon {
                position: fixed;
                bottom: 24px;
                right: 24px;
                width: 60px;
                height: 60px;
                background-color: #0066ff;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                color: #fff;
                font-size: 24px;
                box-shadow: 0 4px 12px rgba(0, 102, 255, 0.2);
                transition: all 0.3s ease;
                z-index: 1000;
            }
            
            .chat-icon:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 16px rgba(0, 102, 255, 0.3);
            }
            
            .notification-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background-color: #ff3b30;
                color: white;
                border-radius: 50%;
                padding: 4px 8px;
                font-size: 12px;
                display: none;
            }
            
            /* Overlay styling */
            .overl {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: none;
                z-index: 1999;
            }
            
            /* Chat container styling */
            .chat-container {
                position: fixed;
                bottom: 96px;
                right: 24px;
                width: 360px;
                height: 480px;
                background-color: #ffffff;
                border-radius: 16px;
                display: none;
                flex-direction: column;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
                transition: all 0.3s ease;
                z-index: 2000;
            }
            
            .chat-header {
                background-color: #0066ff;
                color: #fff;
                padding: 16px;
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
            }
            
            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .header-title {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .bot-avatar {
                font-size: 20px;
            }
            
            .title-text {
                font-weight: 600;
                font-size: 16px;
            }
            
            .close-btn {
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                opacity: 0.8;
                transition: opacity 0.2s ease;
            }
            
            .close-btn:hover {
                opacity: 1;
            }
            
            .header-status {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 12px;
                margin-top: 4px;
            }
            
            .status-indicator {
                width: 8px;
                height: 8px;
                background-color: #4cd964;
                border-radius: 50%;
            }
            
            /* Messages container */
            .messages-container {
                flex-grow: 1;
                overflow-y: auto;
                padding: 16px;
                background-color: #f8f9fa;
                scrollbar-width: thin;
                scrollbar-color: #ccd0d5 #f8f9fa;
                position: relative;
            }
            
            .messages-container::-webkit-scrollbar {
                width: 6px;
            }
            
            .messages-container::-webkit-scrollbar-track {
                background: #f8f9fa;
            }
            
            .messages-container::-webkit-scrollbar-thumb {
                background-color: #ccd0d5;
                border-radius: 3px;
            }
            
            /* Message styling */
            .message {
                padding: 12px 16px;
                border-radius: 16px;
                margin-bottom: 12px;
                max-width: 80%;
                word-wrap: break-word;
                animation: messageAppear 0.3s ease;
            }
            
            .message.user {
                background-color: #0066ff;
                color: #ffffff;
                margin-left: auto;
                border-bottom-right-radius: 4px;
            }
            
            .message.bot {
                background-color: #f0f2f5;
                color: #1c1e21;
                margin-right: auto;
                border-bottom-left-radius: 4px;
            }
            
            @keyframes messageAppear {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            /* Typing indicator */
            .typing-indicator {
                display: none;
                padding: 12px 16px;
                background-color: #f0f2f5;
                border-radius: 16px;
                width: fit-content;
                margin-bottom: 12px; /* Add margin to position it below the user's message */
                margin-left: 0; /* Align to the right for bot responses */
                margin-right: auto; /* Align to the right for bot responses */
            }
            
            .typing-indicator span {
                width: 8px;
                height: 8px;
                background-color: #90949c;
                border-radius: 50%;
                display: inline-block;
                margin: 0 2px;
                animation: typing 1s infinite ease-in-out;
            }
            
            .typing-indicator span:nth-child(2) {
                animation-delay: 0.2s;
            }
            
            .typing-indicator span:nth-child(3) {
                animation-delay: 0.4s;
            }
            
            @keyframes typing {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-4px); }
            }
            
            /* Input area styling */
            .input-area {
                padding: 16px;
                background-color: #ffffff;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                border-top: 1px solid #eaecef;
            }
            
            .input-container {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .input-wrapper {
                flex-grow: 1;
                display: flex;
                align-items: center;
                background-color: #f0f2f5;
                border-radius: 24px;
                padding: 8px 16px;
            }
            
            #user-input {
                flex-grow: 1;
                border: none;
                background: none;
                outline: none;
                padding: 8px 0;
                font-size: 14px;
            }
            
            #send-button {
                background-color: #0066ff;
                border: none;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s ease;
                margin-left: 8px;
            }
            
            #send-button:hover {
                background-color: #0052cc;
            }
            
            .send-icon {
                width: 20px;
                height: 20px;
                filter: brightness(0) invert(1);
            }
            
            /* Dropdown styling */
            .dropdown-container {
                position: relative;
            }
            
            .dropdown-btn {
                background-color: #f0f2f5;
                border: none;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            
            .dropdown-btn:hover {
                background-color: #e4e6eb;
            }
            
            .dots {
                color: #65676b;
                font-size: 24px;
                line-height: 0;
            }
            
            .dropdown-content {
                position: absolute;
                bottom: 100%;
                right: 0;
                margin-bottom: 8px;
                background-color: #ffffff;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                display: none;
                min-width: 180px;
            }
            
            .dropdown-item {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 12px 16px;
                width: 100%;
                border: none;
                background: none;
                cursor: pointer;
                transition: background-color 0.2s ease;
                color: #1c1e21;
                font-size: 14px;
                text-align: left;
            }
            
            .dropdown-item:hover {
                background-color: #f0f2f5;
            }
            
        }
        @media (max-width: 390px) {
            .greeting-container {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 2px;
                margin-right: 8px;
                font-size: 0.2em;
            }
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
            }
            
            /* Chat icon styling */
            .chat-icon {
                position: fixed;
                bottom: 24px;
                right: 24px;
                width: 60px;
                height: 60px;
                background-color: #0066ff;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                color: #fff;
                font-size: 24px;
                box-shadow: 0 4px 12px rgba(0, 102, 255, 0.2);
                transition: all 0.3s ease;
                z-index: 1000;
            }
            
            .chat-icon:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 16px rgba(0, 102, 255, 0.3);
            }
            
            .notification-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background-color: #ff3b30;
                color: white;
                border-radius: 50%;
                padding: 4px 8px;
                font-size: 12px;
                display: none;
            }
            
            /* Overlay styling */
            .overl {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: none;
                z-index: 1999;
            }
            
            /* Chat container styling */
            .chat-container {
                position: fixed;
                bottom: 96px;
                right: 24px;
                width: 360px;
                height: 480px;
                background-color: #ffffff;
                border-radius: 16px;
                display: none;
                flex-direction: column;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
                transition: all 0.3s ease;
                z-index: 2000;
            }
            
            .chat-header {
                background-color: #0066ff;
                color: #fff;
                padding: 16px;
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
            }
            
            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .header-title {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .bot-avatar {
                font-size: 20px;
            }
            
            .title-text {
                font-weight: 600;
                font-size: 16px;
            }
            
            .close-btn {
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                opacity: 0.8;
                transition: opacity 0.2s ease;
            }
            
            .close-btn:hover {
                opacity: 1;
            }
            
            .header-status {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 12px;
                margin-top: 4px;
            }
            
            .status-indicator {
                width: 8px;
                height: 8px;
                background-color: #4cd964;
                border-radius: 50%;
            }
            
            /* Messages container */
            .messages-container {
                flex-grow: 1;
                overflow-y: auto;
                padding: 16px;
                background-color: #f8f9fa;
                scrollbar-width: thin;
                scrollbar-color: #ccd0d5 #f8f9fa;
                position: relative;
            }
            
            .messages-container::-webkit-scrollbar {
                width: 6px;
            }
            
            .messages-container::-webkit-scrollbar-track {
                background: #f8f9fa;
            }
            
            .messages-container::-webkit-scrollbar-thumb {
                background-color: #ccd0d5;
                border-radius: 3px;
            }
            
            /* Message styling */
            .message {
                padding: 12px 16px;
                border-radius: 16px;
                margin-bottom: 12px;
                max-width: 80%;
                word-wrap: break-word;
                animation: messageAppear 0.3s ease;
            }
            
            .message.user {
                background-color: #0066ff;
                color: #ffffff;
                margin-left: auto;
                border-bottom-right-radius: 4px;
            }
            
            .message.bot {
                background-color: #f0f2f5;
                color: #1c1e21;
                margin-right: auto;
                border-bottom-left-radius: 4px;
            }
            
            @keyframes messageAppear {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            /* Typing indicator */
            .typing-indicator {
                display: none;
                padding: 12px 16px;
                background-color: #f0f2f5;
                border-radius: 16px;
                width: fit-content;
                margin-bottom: 12px; /* Add margin to position it below the user's message */
                margin-left: 0; /* Align to the right for bot responses */
                margin-right: auto; /* Align to the right for bot responses */
            }
            
            .typing-indicator span {
                width: 8px;
                height: 8px;
                background-color: #90949c;
                border-radius: 50%;
                display: inline-block;
                margin: 0 2px;
                animation: typing 1s infinite ease-in-out;
            }
            
            .typing-indicator span:nth-child(2) {
                animation-delay: 0.2s;
            }
            
            .typing-indicator span:nth-child(3) {
                animation-delay: 0.4s;
            }
            
            @keyframes typing {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-4px); }
            }
            
            /* Input area styling */
            .input-area {
                padding: 16px;
                background-color: #ffffff;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                border-top: 1px solid #eaecef;
            }
            
            .input-container {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .input-wrapper {
                flex-grow: 1;
                display: flex;
                align-items: center;
                background-color: #f0f2f5;
                border-radius: 24px;
                padding: 8px 16px;
            }
            
            #user-input {
                flex-grow: 1;
                border: none;
                background: none;
                outline: none;
                padding: 8px 0;
                font-size: 14px;
            }
            
            #send-button {
                background-color: #0066ff;
                border: none;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s ease;
                margin-left: 8px;
            }
            
            #send-button:hover {
                background-color: #0052cc;
            }
            
            .send-icon {
                width: 20px;
                height: 20px;
                filter: brightness(0) invert(1);
            }
            
            /* Dropdown styling */
            .dropdown-container {
                position: relative;
            }
            
            .dropdown-btn {
                background-color: #f0f2f5;
                border: none;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            
            .dropdown-btn:hover {
                background-color: #e4e6eb;
            }
            
            .dots {
                color: #65676b;
                font-size: 24px;
                line-height: 0;
            }
            
            .dropdown-content {
                position: absolute;
                bottom: 100%;
                right: 0;
                margin-bottom: 8px;
                background-color: #ffffff;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                display: none;
                min-width: 180px;
            }
            
            .dropdown-item {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 12px 16px;
                width: 100%;
                border: none;
                background: none;
                cursor: pointer;
                transition: background-color 0.2s ease;
                color: #1c1e21;
                font-size: 14px;
                text-align: left;
            }
            
            .dropdown-item:hover {
                background-color: #f0f2f5;
            }
        }
        
        /* Keyframes for sliding animations */
        @keyframes slideInLeft {
            from {
                transform: translateX(-20%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInBottom {
            from {
                transform: translateY(20%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Calendar Styles */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin: 10px auto;
            
        }
        
        .day {
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 50%;
            background-color: #f9f9f9;
            font-size: 0.7em;
            position: relative;
            font-family: Comfortaa;
        }
        
        .day.active {
            background-color:rgb(255, 166, 0);
            color: black;
            z-index: 1;
            font-weight: bold;

        }
        
        .day.active::before {
            content: '🔥';
            font-size: 30px;
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            z-index: -1;
            animation: flame 1s infinite;
        }
        
        @keyframes flame {
            0%, 100% {
                transform: translateX(-50%) translateY(0) scale(1);
            }
            50% {
                transform: translateX(-50%) translateY(-3px) scale(1.1);
            }
        }
        
        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
        }
        
        .nav-buttons button {
            padding: 3px 8px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 0.8em;
        }
        
        #monthYear {
            font-size: 0.9em;
            font-family: Comfortaa;

        }
        
        /* Chart size controls */
        #dass21Chart {
            max-height: 200px;
            width: 100% !important;
        }
        
        #lineChart {
            max-height: 235px;
            width: 100% !important;
        }
        
        /* User Info Styles */
        .user-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #ccc;
            padding: 0.75rem;
            border-radius: 8px;
            max-width: 220px;
            margin: 1rem auto;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
        }
        
        .profile-image-container {
            position: relative;
            display: inline-block;
            margin-bottom: 0.75rem;
        }
        
        .profile-image-container img {
            border-radius: 50%;
            width: auto;
            height: auto;
            max-width: 100px;
            max-height: 100px;
            object-fit: cover;
            border: 2px solid #fff;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }
        
        .profile-image-container .fa-plus {
            position: absolute;
            bottom: 8px;
            right: 5px;
            background: #2ecc71;
            border-radius: 50%;
            padding: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            color: white;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }
        
        .profile-image-container .fa-plus:hover {
            transform: scale(1.1);
        }
        
        .profile-image-upload {
            display: none;
        }
        
        .user-details {
            width: 100%;
            text-align: center;
        }
        
        .user-details h2 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
            color: rgba(255, 252, 252, 0.9);
            font-weight: 500;
        }
        
        .user-details p {
            margin: 0.25rem 0;
            font-size: 0.8rem;
            color: rgba(255, 252, 252, 0.8);
            font-weight: 400;
            line-height: 1.4;
        }
        
        /* Assessment Link Styles */
        .assessment-link a {
            text-decoration: none;
            color: #3498db;
        }
        
        .assessment-link a.disabled {
            color: gray;
            pointer-events: none;
            cursor: not-allowed;
        }
        
        .assessment-link .tooltup {
            visibility: hidden;
            width: 200px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .assessment-link:hover .tooltup {
            visibility: visible;
            opacity: 1;
        }
        
        /* Adjusting the size of the button */
        .refresh-button {
            position: relative;
            display: inline-block;
            padding: 2px; /* Further reduced padding */
            background-color: #4CAF50; /* Green background */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 8px; /* Further reduced font size */
        }

        .refresh-button:disabled {
            background-color: #ccc; /* Gray background when disabled */
            cursor: not-allowed;
        }

        /* Adjusting the size of the refresh icon inside the button */
        .refresh-icon {
            width: 40px; /* Reduced width */
            height: 40px; /* Reduced height */
        }

        /* Styles for the tooltip */
        .tooltip {
            display: none;
            position: absolute;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            z-index: 1;
            width: 200px;
            bottom: 125%; /* Position the tooltip above the button */
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* Show the tooltip on hover */
        .refresh-button:hover .tooltip {
            display: block;
            opacity: 1;
        }


        .dropdown-refresh-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .custom-select-container {
            position: relative;
            width: 100%;
            max-width: 200px;
        }
        
        .custom-select {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: white;
            font-size: 0.9em;
            width: 100%;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="#3498db" d="M2 0L0 2h4zM2 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.7em top 50%;
            background-size: 0.65em auto;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 255, 0.3); /* Blue shadow */
            font-family: Comfortaa;
        }
        
        .custom-select:hover {
            border-color: #3498db;
        }
        
        .custom-select-container::after {
            content: "";
            position: absolute;
            top: 50%;
            right: 10px;
            width: 0.8em;
            height: 0.5em;
            background-color: #3498db;
            clip-path: polygon(100% 0%, 0 0%, 50% 100%);
            transform: translateY(-50%);
            pointer-events: none;
        }
        
        .custom-select option:checked {
            background-color: #3498db; /* Selected option in blue */
            color: white; /* Text color for selected option */
        }
        
        .custom-select option:hover {
            background-color: #2980b9; /* Hover option in blue */
            color: white; /* Text color for hover option */
        }
        
        .greeting-container {
            display: flex;
            flex-direction:column;
            justify-content: space-between;
            background-color: rgb(70, 118, 191);
            border-radius: 15px;
            padding-left: 10px;
            padding-right: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Comfortaa';
            color: white;
            font-size: 0.8em;
        }
        .text-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Comfortaa';
            color: black;
            font-size: 0.8em;
        }
        .image-container {
            position: relative;
            display: inline-block;
            margin-bottom: 0.75rem;
        }
        .image-container img {
            border-radius: 50%;
            width: auto;
            height: auto;
            max-width: 100px;
            max-height: 100px;
            object-fit: cover;
            border: 2px solid #fff;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }
        .recommendations-container #recommendationContent {
            height: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        
        /* Chat icon styling */
        .chat-icon {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background-color: #0066ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #fff;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .chat-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 102, 255, 0.3);
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff3b30;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
            display: none;
        }
        
        /* Overlay styling */
        .overl {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1999;
        }
        
        /* Chat container styling */
        .chat-container {
            position: fixed;
            bottom: 50px; /* Adjusted from 96px to 50px to move it a bit below */
            right: 24px;
            width: 360px;
            height: 480px;
            background-color: #ffffff;
            border-radius: 16px;
            display: none;
            flex-direction: column;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            transition: all 0.3s ease;
            z-index: 2000;
        }
        .chat-header {
            background-color: #0066ff;
            color: #fff;
            padding: 16px;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bot-avatar {
            font-size: 20px;
        }
        
        .title-text {
            font-weight: 600;
            font-size: 16px;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }
        
        .close-btn:hover {
            opacity: 1;
        }
        
        .header-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            margin-top: 4px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            background-color: #4cd964;
            border-radius: 50%;
        }
        
        /* Messages container */
        .messages-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 16px;
            background-color: #f8f9fa;
            scrollbar-width: thin;
            scrollbar-color: #ccd0d5 #f8f9fa;
            position: relative;
        }
        
        .messages-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .messages-container::-webkit-scrollbar-track {
            background: #f8f9fa;
        }
        
        .messages-container::-webkit-scrollbar-thumb {
            background-color: #ccd0d5;
            border-radius: 3px;
        }
        
        /* Message styling */
        .message {
            padding: 12px 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            max-width: 80%;
            word-wrap: break-word;
            animation: messageAppear 0.3s ease;
        }
        
        .message.user {
            background-color: #0066ff;
            color: #ffffff;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        
        .message.bot {
            background-color: #f0f2f5;
            color: #1c1e21;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        
        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Typing indicator */
        .typing-indicator {
            display: none;
            padding: 12px 16px;
            background-color: #f0f2f5;
            border-radius: 16px;
            width: fit-content;
            margin-bottom: 12px; /* Add margin to position it below the user's message */
            margin-left: 0; /* Align to the right for bot responses */
            margin-right: auto; /* Align to the right for bot responses */
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: #90949c;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1s infinite ease-in-out;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
        
        /* Input area styling */
        .input-area {
            padding: 16px;
            background-color: #ffffff;
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
            border-top: 1px solid #eaecef;
        }
        
        .input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            background-color: #f0f2f5;
            border-radius: 24px;
            padding: 8px 16px;
        }
        
        #user-input {
            flex-grow: 1;
            border: none;
            background: none;
            outline: none;
            padding: 8px 0;
            font-size: 14px;
        }
        
        /* Base style for the send button */
        #send-button {
            background-color: #0066ff;          /* Blue background */
            border: none;                       /* No border */
            border-radius: 50%;                 /* Circular shape */
            width: 36px;                        /* Set width */
            height: 36px;                       /* Set height */
            display: flex;                       /* Flexbox to center content */
            align-items: center;                /* Vertically center the icon */
            justify-content: center;            /* Horizontally center the icon */
            cursor: pointer;                    /* Pointer cursor on hover */
            transition: all 0.2s ease;           /* Smooth transition for all properties */
            margin-left: 8px;                    /* Space to the left of the button */
        }

        /* Hover effect for the send button */
        #send-button:hover {
            background-color: #0052cc;           /* Darker blue when hovered */
            transform: scale(1.1);                /* Slightly grow the button */
        }

        /* Focus effect for accessibility */
        #send-button:focus {
            outline: none;                        /* Remove default outline */
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.5);  /* Add a soft blue glow */
        }

        /* Disabled button state */
        #send-button:disabled {
            background-color: #d6d6d6;            /* Light gray background when disabled */
            cursor: not-allowed;                  /* Change cursor to not-allowed */
            transform: scale(1);                   /* Remove scaling effect */
        }

        /* Icon inside the send button */
        .send-icon {
            width: 20px;                          /* Icon width */
            height: 20px;                         /* Icon height */
            filter: brightness(0) invert(1);      /* Invert the color of the icon to white */
            transition: filter 0.2s ease;         /* Smooth transition for icon filter */
        }

        /* Send icon when the button is disabled (faded) */
        #send-button:disabled .send-icon {
            filter: brightness(0) invert(0.5);    /* Fade the icon color when disabled */
        }

        /* Dropdown styling */
        .dropdown-container {
            position: relative;
        }
        
        .dropdown-btn {
            background-color: #f0f2f5;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .dropdown-btn:hover {
            background-color: #e4e6eb;
        }
        
        .dots {
            color: #65676b;
            font-size: 24px;
            line-height: 0;
        }
        
        .dropdown-content {
            position: absolute;
            bottom: 100%;
            right: 0;
            margin-bottom: 8px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            display: none;
            min-width: 180px;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            width: 100%;
            border: none;
            background: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            color: #1c1e21;
            font-size: 14px;
            text-align: left;
        }
        
        .dropdown-item:hover {
            background-color: #f0f2f5;
        }
        @media (max-width: 700px) {
            .line-chart-container {
                display: block;
            }
        }
        .logout-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: auto;
            min-width: 160px;
            padding: 12px 24px;
            border-radius: 8px;
            background: linear-gradient(135deg, #FF4B2B, #FF416C);
            box-shadow: 0 4px 15px rgba(255, 75, 43, 0.3);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .logout-button:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 75, 43, 0.4);
        }
        
        .logout-button:active {
            transform: translateX(-50%) translateY(0);
            box-shadow: 0 2px 10px rgba(255, 75, 43, 0.2);
        }
        
        .logout-button-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: white;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 15px;
            letter-spacing: 0.5px;
        }
        
        .logout-button-content svg {
            width: 18px;
            height: 18px;
            stroke-width: 2.5;
            transition: transform 0.3s ease;
        }
        
        .logout-button:hover .logout-button-content svg {
            transform: translateX(3px);
        }
    </style>
    <style>
        .rotate-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(20,20,20,0.95));
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            backdrop-filter: blur(5px);
            animation: overlayEntry 0.5s ease-out;
        }
        
        .rotate-message {
            text-align: center;
            padding: 2rem;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            max-width: 80%;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform-style: preserve-3d;
        }
        
        .rotate-icon {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            animation: rotatePulse 2s infinite;
        }
        
        .rotate-message p {
            font-size: 1.5rem;
            margin: 0 0 1rem 0;
            line-height: 1.4;
            font-weight: 500;
        }
        
        .rotate-hint {
            display: block;
            opacity: 0.7;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
        
        @keyframes rotatePulse {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(90deg) scale(1.2); }
            100% { transform: rotate(90deg) scale(1); }
        }
        
        @keyframes overlayEntry {
            from { opacity: 0; backdrop-filter: blur(0px); }
            to { opacity: 1; backdrop-filter: blur(5px); }
        }
        
        @media (max-width: 768px) {
            .rotate-message p {
                font-size: 1.2rem;
            }
            .rotate-icon {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="rotate-overlay" id="rotateDevicePrompt">
        <div class="rotate-message">
            <div class="rotate-icon">↻</div>
            <p>Please switch to Portrait mode for a better experience</p>
            <small class="rotate-hint">(Device rotation not supported? Try resizing your window)</small>
        </div>
    </div>
    <div class="content-overlay" id="overlay"></div>
    <div class="side-panel" id="sidePanel">
        <div class="toggle-btn" onclick="toggleSidePanel()">
            <i class="fas fa-bars"></i>
        </div>
        <div class="user-info">
            <div class="profile-image-container">
                <img id="profileImage" 
                src="{% if profile_image_url %}{{ profile_image_url }}{% else %}data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PGNpcmNsZSBjeD0iNTAiIGN5PSIzNiIgcj0iMjQiIGZpbGw9IiNkZGQiLz48cGF0aCBkPSJNMjQsNzQgQzI0LDUzIDc2LDUzIDc2LDc0IEw3NiwxMDAgTDI0LDEwMCBMMjQsNzQgWiIgZmlsbD0iI2RkZCIvPjwvc3ZnPg=={% endif %}" 
                alt="User Profile">
                <i class="fas fa-plus" onclick="document.getElementById('profileImageUpload').click();"></i>
            </div>
            <input type="file" id="profileImageUpload" class="profile-image-upload" accept="image/*">
            
            <div class="user-details">
                <div class='text-container'>
                <h2>{{ user_data.username }}</h2>
                </div>
                <p style="font-family: 'Comfortaa'"><strong>Name:</strong> {{ user_data.name }}</p>
                <p style="font-family: 'Comfortaa'; font-size: 0.7em;" data-full-text="{{ user_data.email }}"><strong>Email:</strong> {{ user_data.email }}</p>
                <p style="font-family: 'Comfortaa'"><strong>Mobile Number:</strong> {{ user_data.mobile }}</p>
                <p style="font-family: 'Comfortaa'"><strong>Age:</strong> {{ user_data.age }}</p>
                <p style="font-family: 'Comfortaa'"><strong>Occupation:</strong> {{ user_data.occupation }}</p>
                <p style="font-family: 'Comfortaa'"><strong>Gender:</strong> {{ user_data.gender }}</p>
            </div>
        </div>
        <div class="menu">
            <div class="assessment-link" style="position: relative; display: inline-block;">
            <a href="{% url 'assessment' %}" class="{% if has_taken_assessment_today %}disabled{% endif %}" style="font-family: 'Comfortaa';display: flex; align-items: center;">
                <img src="/media/images/ext_file_generic-512.webp" alt="Paper Logo" style="margin-right: 5px; width: 32px; height: 32px;">
                Take Assessment
            </a>
            {% if has_taken_assessment_today %}
                <span style="font-family: 'Comfortaa'" class="tooltup">Assessment taken today, come back tomorrow</span>
            {% endif %}
            </div>
            <div class="assessment-link" style="position: relative; display: inline-block; margin-top: 10px;">
                <a href="{% url 'journal' %}" style="font-family: 'Comfortaa';display: flex; align-items: center;">
                    <img src="" alt="Refresh Icon" style="margin-right: 5px; width: 32px; height: 32px;">
                    Journal
                </a>
            </div>
            <div class="logout-link" style="position: relative; display: inline-block; margin-top: 10px;">
                <a href="{% url 'logout' %}" style="font-family: 'Comfortaa';display: flex; align-items: center;">
                    <img src="/media/images/power.png" alt="Logout Icon" style="margin-right: 5px; width: 32px; height: 32px;">
                    Logout
                </a>
            </div>
        </div>
        </div>

    <div class="content" id="content">
        <div style="display: flex; justify-content: space-between; align-items: center; position: relative;">
            <div class="greeting-container">
                <h1>Hello, {{ user_data.name }} !</h1>
            </div>              
            <div class="image-container">
                <img id="profileImageTopRight" src="{% if profile_image_url %}{{ profile_image_url }}{% else %}/media/images/avatar-1024x1024.jpeg{% endif %}" alt="User Logo" style="width: 50px; height: 50px; border-radius: 50%; cursor: pointer;" onclick="toggleLogoutBox()">
            </div>
            <div id="logoutBox" style=" font-family: Comfortaa; display: none; position: fixed; top: 60px; right: 20px; background: white; border: 1px solid #ccc; padding: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.1); z-index: 1001;">
                <p>Do you want to logout?</p>
                <a href="{% url 'logout' %}" style="color: red;">Logout</a>
            </div>
        </div>
        {% if not profile_image_url %}
            <p style="font-family: 'Comfortaa'" >Please <a href="" onclick="document.getElementById('profileImageUpload').click(); return false;">add a profile photo</a>.</p>
        {% endif %}

        <div class="dashboard-layout">
            <div class="left-column">
                <div class="calendar-container">
                    <div class='text-container'>
                    <h2 style="font-size: 1em;">Streaks</h2>
                    </div>
                    <div class="nav-buttons">
                        <button onclick="changeMonth(-1)">&#9664;</button>
                        <div id="monthYear"></div>
                        <button onclick="changeMonth(1)">&#9654;</button>
                    </div>
                    <div class="calendar" id="calendar"></div>
                </div>

                {% if scores %}
                <div class="chart-container">
                    <div class='text-container'>
                    <h2 style="font-size: 1em;">Assessment Scores</h2>
                    </div>
                    <div class="custom-select-container">
                        <select id="assessmentDateDropdown" class="custom-select" onchange="updatePieChart()">
                            <option value="latest">Latest Assessment</option>
                            {% for score in all_scores %}
                                <option value="{{ score.date }}">{{ score.date }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <canvas id="dass21Chart"></canvas>
                    <p style="font-family: 'Comfortaa'" style="font-size: 0.8em;">Depression: <span id="depressionSeverity">{{ severity.depression }}</span></p>
                    <p style="font-family: 'Comfortaa'" style="font-size: 0.8em;">Anxiety: <span id="anxietySeverity">{{ severity.anxiety }}</span></p>
                    <p style="font-family: 'Comfortaa'" style="font-size: 0.8em;">Stress: <span id="stressSeverity">{{ severity.stress }}</span></p>
                </div>
                {% else %}
                <div class="chart-container">
                    <div class="text-container">
                    <h2 style="font-size: 1em;">No Assessment Scores</h2>
                    <p>Please take the assessment test first.</p>
                    </div>
                </div>
                {% endif %}
            </div>
            <div class="right-column">
            {% if scores %}
            <div class="line-graph-container">
                <div class='text-container'>
                <h2 style="font-size: 1em;">Cumulative Scores per week</h2>
                </div>
                <canvas id="lineChart"></canvas>
            </div>
            {% endif %}

            <div class="recommendations-container">
                <div class='text-container'>
                <h2>Personalized Recommendations</h2>
                </div>
                <!-- Dropdown to select previous recommendations -->
                <div class="dropdown-refresh-container">
                    <div class="custom-select-container">
                      <select id="recommendationDropdown" class="custom-select" onchange="updateRecommendation()">
                        <option value="latest">Recommendations</option>
                        {% for recommendation in all_recommendations %}
                            <option value="{{ recommendation.recommendations }}">
                                {{ recommendation.timestamp|date:"Y-m-d H:i" }}
                            </option>
                        {% endfor %}
                      </select>
                    </div>
                    
                    <!-- Form to generate new recommendations with refresh icon -->
                    <form method="POST" action="{% url 'user_view' %}">
                      {% csrf_token %}
                      <button type="submit" name="generate_recommendations" class="refresh-button" 
                          {% if has_recommended_today or not has_taken_assessment_today %}disabled{% endif %}
                          title="{% if not has_taken_assessment_today %}You haven't taken the assessment today. Please complete the assessment to generate recommendations.{% else %}{% if has_recommended_today %}You have already generated recommendations today. Please check back tomorrow.{% endif %}{% endif %}">
                          <img src="/media/images/refresh.png" class="refresh-icon" alt="Refresh">
                      </button>
                    </form>
                  </div>
                  
                <!-- Display the selected recommendation -->
                <div id="recommendationContent">
                    {% if recommendations %}
                        <p>{{ recommendations|linebreaksbr }}</p>
                    {% else %}
                        <p style="font-family: 'Comfortaa'" >No recommendations available. Please generate new recommendations.</p>
                    {% endif %}
                </div>
            </div>
<!-- Chat Icon -->
<div class="chat-icon" id="chat-icon">
    <img src="/media/images/m.png" alt="Chat Icon" style="width: 32px; height: 32px; filter: brightness(0) invert(1); pointer-events: none;">
    <span class="notification-badge" id="notification-badge">1</span>
</div>

<!-- Overlay -->
<div class="overl" id="overl"></div>

<!-- Chat Container -->
<div id="chatbox" class="chat-container">
    <div class="chat-header">
        <div class="header-content">
            <div class="header-title">
                <span class="bot-avatar">🤖</span>
                <span class="title-text">MindMate AI</span>
            </div>
            <button class="close-btn" id="close-chat">&times;</button>
        </div>
        <div class="header-status">
            <span class="status-indicator"></span>
            <span class="status-text">Online</span>
        </div>
    </div>
    <div id="messages" class="messages-container">
        <!-- Messages will be inserted here -->
        <div class="typing-indicator" id="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <div class="input-area">
        <div class="input-container">
            <div class="input-wrapper">
                <input 
                    type="text" 
                    id="user-input" 
                    placeholder="Type your message here..."
                    aria-label="Message input"
                >
                <button id="send-button" aria-label="Send message">
                    <img 
                        src="/media/images/R.png" 
                        alt="Send" 
                        class="send-icon"
                    >
                </button>
            </div>
            <div class="dropdown-container">
                <button 
                    class="dropdown-btn" 
                    id="dropdown-btn"
                    aria-label="Additional options"
                >
                    <span class="dots" style=" pointer-events: none;">⋮</span>
                </button>
                <div class="dropdown-content" id="dropdown-content">
                    <button id="user-info-btn" class="dropdown-item">
                        <span class="item-icon">📊</span>
                        Latest Reports
                    </button>
                    <button id="journalInfoBtn" class="dropdown-item">
                        <span class="item-icon">📖</span>
                        Journal
                    </button>
                    <button id="clear-chat-btn" class="dropdown-item">
                        <span class="item-icon">🧹</span>
                        Clear Chat
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
    </div>
    </div>

<script>
// DOM Elements
const chatbox = document.getElementById("chatbox");
const chatIcon = document.getElementById("chat-icon");
const userInput = document.getElementById("user-input");
const sendButton = document.getElementById("send-button");
const dropdownBtn = document.getElementById("dropdown-btn");
const dropdownContent = document.getElementById("dropdown-content");
const userInfoBtn = document.getElementById("user-info-btn");
const closeButton = document.getElementById("close-chat");
const messagesContainer = document.getElementById("messages");
let typingIndicator = document.getElementById("typing-indicator");
const notificationBadge = document.getElementById("notification-badge");
const overl = document.getElementById("overl");
const clearChatBtn = document.getElementById("clear-chat-btn");
const journalInfoBtn = document.getElementById("journalInfoBtn");

// Chat State Management
let isTyping = false;
let isProcessingResponse = false;  // To track if a bot response is being processed
const chatState = {
  isChatboxOpen: false,  // Default state is closed
  isDropdownOpen: false,
  unreadMessages: 0
};

// Initialize Chat
window.addEventListener("load", async () => {
  updateChatVisibility();  // Ensure the chat starts in the closed state
  await fetchConversationHistory();
  if (chatState.isChatboxOpen) messagesContainer.scrollTop = messagesContainer.scrollHeight;
});

// Chat Visibility Functions
function updateChatVisibility() {
  chatbox.style.display = chatState.isChatboxOpen ? "flex" : "none";
  overl.style.display = chatState.isChatboxOpen ? "block" : "none";
  chatbox.style.opacity = chatState.isChatboxOpen ? "1" : "0";
  chatbox.style.transform = chatState.isChatboxOpen ? "translateY(0)" : "translateY(20px)";

  if (chatState.isChatboxOpen) {
    notificationBadge.style.display = "none";
    chatState.unreadMessages = 0;
  }
}

// Event Listeners
chatIcon.addEventListener("click", () => {
  chatState.isChatboxOpen = !chatState.isChatboxOpen;
  updateChatVisibility();
});

closeButton.addEventListener("click", () => {
  chatState.isChatboxOpen = false;
  updateChatVisibility();
});

document.addEventListener("click", (event) => {
  if (!chatbox.contains(event.target) && event.target !== chatIcon && !overl.contains(event.target)) {
    chatState.isChatboxOpen = false;
    updateChatVisibility();
  }

  if (!dropdownContent.contains(event.target) && event.target !== dropdownBtn) {
    dropdownContent.style.display = "none";
    dropdownBtn.classList.remove("open");
    chatState.isDropdownOpen = false;
  }
});

dropdownBtn.addEventListener("click", () => {
  chatState.isDropdownOpen = !chatState.isDropdownOpen;
  dropdownContent.style.display = chatState.isDropdownOpen ? "block" : "none";
  dropdownBtn.classList.toggle("open", chatState.isDropdownOpen);
});

// Message Handling
function applyFormatting(content) {
  return content
    .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
    .replace(/\*(.*?)\*/g, '<strong>$1</strong>')
    .replace(/---/g, '<hr>')
    .replace(/### (.*?)(\n|$)/g, '<div class="heading">$1</div>')
    .replace(/(?:^|\n)[*-] (.*?)(?=\n|$)/g, '<li>$1</li>')
    .replace(/(<li>.*?<\/li>)+/gs, '<ul>$&</ul>')
    .replace(/\n/g, '<br>');
}

function showTypingIndicator() {
  if (!isTyping) {
    isTyping = true;
    typingIndicator.style.display = 'flex';
    messagesContainer.appendChild(typingIndicator);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }
}

function hideTypingIndicator() {
  isTyping = false;
  typingIndicator.style.display = 'none';
  messagesContainer.removeChild(typingIndicator);
}

function addMessage(message, isUser = true) {
  const messageDiv = document.createElement('div');
  messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
  messageDiv.innerHTML = `
    <strong>${isUser ? 'You' : 'Chatbot'}:</strong> 
    ${applyFormatting(message)}
  `;
  messagesContainer.appendChild(messageDiv);

  if (!isUser && !chatState.isChatboxOpen) {
    chatState.unreadMessages++;
    notificationBadge.textContent = chatState.unreadMessages;
    notificationBadge.style.display = "block";
  }

  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// Disable the Send button
function disableSendButton() {
  sendButton.disabled = true;
  sendButton.classList.add('disabled');
  sendButton.classList.remove('enabled');
}

// Enable the Send button
function enableSendButton() {
  sendButton.disabled = false;
  sendButton.classList.remove('disabled');
  sendButton.classList.add('enabled');
}

// Message Sending
async function sendMessage(message) {
  try {
    // Disable the send button while the bot is responding
    disableSendButton();

    addMessage(message, true);
    userInput.value = "";
    showTypingIndicator();

    const response = await fetch("/chatbot/", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "X-CSRFToken": "{{ csrf_token }}"
      },
      body: `message=${encodeURIComponent(message)}`
    });

    const data = await response.json();
    hideTypingIndicator();

    if (data.response) {
      addMessage(data.response, false);
    } else {
      addMessage("Sorry, there was an error processing your request.", false);
    }

    // After the bot response, enable the Send button again
    enableSendButton();
  } catch (error) {
    hideTypingIndicator();
    addMessage("Sorry, there was an error connecting to the server.", false);

    // After error, still allow the user to send a message
    enableSendButton();
  }
}

// Event listeners for user input and button
userInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    const message = userInput.value.trim();
    if (message && !sendButton.disabled) {  // Check if the button is not disabled
      sendMessage(message);
    }
  }
});

sendButton.addEventListener("click", () => {
  const message = userInput.value.trim();
  if (message && !sendButton.disabled) {  // Check if the button is not disabled
    sendMessage(message);
  }
});

// Chat Management
userInfoBtn.addEventListener("click", () => {
  sendMessage("Please provide my latest reports information");
  dropdownContent.style.display = "none";
  dropdownBtn.classList.remove("open");
  chatState.isDropdownOpen = false;
});

journalInfoBtn.addEventListener("click", () => {
  sendMessage("Please provide my journal information");
  dropdownContent.style.display = "none";
  dropdownBtn.classList.remove("open");
  chatState.isDropdownOpen = false;
});

clearChatBtn.addEventListener("click", async () => {
  if (confirm("Are you sure you want to clear the chat history? This action cannot be undone.")) {
    try {
      const response = await fetch("/archive-chat/", {
        method: "POST",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}"
        }
      });

      if (response.ok) {
        messagesContainer.innerHTML = '<div class="typing-indicator" id="typing-indicator"><span></span><span></span><span></span></div>';
        typingIndicator = document.getElementById("typing-indicator");
        notificationBadge.style.display = "none";
      }
    } catch (error) {
      console.error("Clear chat error:", error);
      alert("Failed to clear chat history. Please try again.");
    }

    dropdownContent.style.display = "none";
    dropdownBtn.classList.remove("open");
    chatState.isDropdownOpen = false;
  }
});
    
    // Initialization
    async function fetchConversationHistory() {
      try {
        const response = await fetch("/chatbot/", {
          method: "GET",
          headers: {
            "X-CSRFToken": "{{ csrf_token }}"
          }
        });
    
        const data = await response.json();
        if (data.conversation_history) {
          data.conversation_history.forEach(msg => {
            addMessage(msg.message, msg.role === "user");
          });
        }
      } catch (error) {
        console.error("History load error:", error);
      }
    }
    
    // Recommendation Content Formatting
    function applyFormatting(content) {
      // Apply bold tags
      content = content.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
    
      // Apply small bold tags
      content = content.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
    
      // Apply horizontal line
      content = content.replace(/---/g, '<hr>');
    
      // Apply heading tags
      content = content.replace(/### (.*?)(\n|$)/g, '<div class="heading">$1</div>');
    
      // Apply bullet points
      content = content.replace(/(?:^|\n)- (.*?)(\n|$)/g, '<ul><li>$1</li></ul>');
    
      // Merge consecutive <ul> tags
      content = content.replace(/<\/ul>\n<ul>/g, '');
    
      // Replace new lines with <br> tags
      content = content.replace(/\n/g, '<br>');
    
      return content;
    }
    
    document.addEventListener("DOMContentLoaded", function () {
      let recommendationContent = document.getElementById("recommendationContent");
    
      if (recommendationContent) {
        let contentHtml = recommendationContent.innerHTML;
        recommendationContent.innerHTML = applyFormatting(contentHtml);
      }
    });
    
    // Function to update the displayed recommendation based on the dropdown selection
    function updateRecommendation() {
      const dropdown = document.getElementById('recommendationDropdown');
      const selectedRecommendation = dropdown.value;
      const recommendationContent = document.getElementById('recommendationContent');
    
      let formattedContent = '';
    
      if (selectedRecommendation === 'latest') {
        // Display the latest recommendation
        formattedContent = `{{ recommendations|default:"No recommendations available." }}`;
      } else {
        // Display the selected recommendation
        formattedContent = selectedRecommendation;
      }
    
      // Apply formatting to the new content
      recommendationContent.innerHTML = applyFormatting(formattedContent);
    }
    
    // Logout Box Toggle
    function toggleLogoutBox() {
      const logoutBox = document.getElementById('logoutBox');
      logoutBox.style.display = logoutBox.style.display === 'none' ? 'block' : 'none';
    }
    
    document.addEventListener('click', function (event) {
      const logoutBox = document.getElementById('logoutBox');
      const profileImageTopRight = document.getElementById('profileImageTopRight');
      if (!logoutBox.contains(event.target) && !profileImageTopRight.contains(event.target)) {
        logoutBox.style.display = 'none';
      }
    });
    
    // Toggle Side Panel
    function toggleSidePanel() {
      const sidePanel = document.getElementById('sidePanel');
      const overlay = document.getElementById('overlay');
      sidePanel.classList.toggle('open');
      overlay.classList.toggle('active');
    }
    
    // Close panel when clicking overlay
    document.getElementById('overlay').addEventListener('click', function () {
      const sidePanel = document.getElementById('sidePanel');
      const overlay = document.getElementById('overlay');
      sidePanel.classList.remove('open');
      overlay.classList.remove('active');
    });
    
    // Handle Profile Image Upload
    document.getElementById('profileImageUpload').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById('profileImage').src = e.target.result;
          uploadImage(file);
        };
        reader.readAsDataURL(file);
      }
    });
    
    // Upload Image to Server
    function uploadImage(file) {
      const formData = new FormData();
      formData.append('profile_image', file);
    
      fetch('/upload_profile_image/', {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': getCookie('csrftoken')
        }
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            console.log('Image uploaded successfully');
          } else {
            console.error('Failed to upload image');
          }
        });
    }
    
    // Get CSRF Token
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    
    // Calendar functionality
    let currentYear = new Date().getFullYear();
    let currentMonth = new Date().getMonth();
    
    function renderCalendar() {
      const loginTimes = [
        {% for login_time in login_times %}
          '{{ login_time.date }}',
        {% endfor %}
      ];
    
      const calendar = document.getElementById('calendar');
      const monthYear = document.getElementById('monthYear');
      const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    
      monthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;
      calendar.innerHTML = '';
    
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    
      for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'day';
        calendar.appendChild(emptyCell);
      }
    
      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'day';
        dayCell.textContent = day;
    
        const dateString = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        if (loginTimes.includes(dateString)) {
          dayCell.classList.add('active');
        }
    
        calendar.appendChild(dayCell);
      }
    }
    
    function changeMonth(offset) {
      currentMonth += offset;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }
    
    // Initialize calendar and charts
    document.addEventListener('DOMContentLoaded', () => {
      renderCalendar();
    
      {% if scores %}
      // Pie Chart for Latest Scores
      const initialDepression = {{ scores.depression|default:0 }};
      const initialAnxiety = {{ scores.anxiety|default:0 }};
      const initialStress = {{ scores.stress|default:0 }};
    
      const ctxPie = document.getElementById('dass21Chart').getContext('2d');
      pieChart = new Chart(ctxPie, {
        type: 'pie',
        data: {
          labels: ['Depression', 'Anxiety', 'Stress'],
          fontFamily: 'Comfortaa',
          datasets: [{
            data: [initialDepression, initialAnxiety, initialStress],
            backgroundColor: [
              'rgba(255, 99, 132, 0.2)',
              'rgba(54, 162, 235, 0.2)',
              'rgba(75, 192, 192, 0.2)'
            ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(75, 192, 192, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: true // Show legend for pie chart
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  let label = context.label || '';
                  if (label) {
                    label += ': ';
                  }
                  if (context.raw !== null) {
                    label += context.raw;
                  }
                  return label;
                }
              }
            }
          },
          animation: {
            animateScale: true,
            animateRotate: true
          },
          hover: {
            onHover: function (e, elements) {
              if (elements.length) {
                e.native.target.style.cursor = 'pointer';
              } else {
                e.native.target.style.cursor = 'default';
              }
            }
          }
        }
      });
    
      // Line Graph for Cumulative Scores Over Time
      const ctxLine = document.getElementById('lineChart').getContext('2d');
      const lineChart = new Chart(ctxLine, {
        type: 'line',
        data: {
          labels: [
            {% for score in daily_scores|slice:"-7:" %}  // <-- Add slice filter here
            '{{ score.date }}',
            {% endfor %}
          ],
          datasets: [
            {
              label: 'Depression',
              data: [
                {% for score in daily_scores|slice:"-7:" %}  // <-- Add slice filter here
                {{ score.depression }},
                {% endfor %}
              ],
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              borderWidth: 2,
              fill: false,
              pointHoverRadius: 7, // Increase point radius on hover
              pointHoverBorderWidth: 2
            },
            {
              label: 'Anxiety',
              data: [
                {% for score in daily_scores|slice:"-7:" %}  // <-- Add slice filter here
                {{ score.anxiety }},
                {% endfor %}
              ],
              borderColor: 'rgba(54, 162, 235, 1)',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderWidth: 2,
              fill: false,
              pointHoverRadius: 7, // Increase point radius on hover
              pointHoverBorderWidth: 2
            },
            {
              label: 'Stress',
              data: [
                {% for score in daily_scores|slice:"-7:" %}  // <-- Add slice filter here
                {{ score.stress }},
                {% endfor %}
              ],
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderWidth: 2,
              fill: false,
              pointHoverRadius: 7, // Increase point radius on hover
              pointHoverBorderWidth: 2
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              display: true,
              grid: {
                display: true
              },
              ticks: {
                display: false // Hide labels
              },
              title: {
                display: false // Hide title
              }
            },
            y: {
              display: true,
              grid: {
                display: true
              },
              ticks: {
                display: false // Hide labels
              },
              title: {
                display: false // Hide title
              },
              beginAtZero: true
            }
          },
          plugins: {
            legend: {
              display: false // Hide legend for line chart
            },
            tooltip: {
              enabled: true // Ensure tooltips are enabled
            }
          }
        }
      });
    
      // Function to update the line chart options based on device width
      function updateChartOptions() {
        if (window.innerWidth <= 500) {
          lineChart.options.scales.x.ticks.display = false;
          lineChart.options.scales.y.ticks.display = false;
          lineChart.options.plugins.legend.display = false;
        } else {
          lineChart.options.scales.x.ticks.display = true;
          lineChart.options.scales.y.ticks.display = true;
          lineChart.options.plugins.legend.display = true;
        }
        lineChart.update();
      }
    
      // Call the function initially
      updateChartOptions();
    
      // Add event listener to update options on resize
      window.addEventListener('resize', updateChartOptions);
      {% endif %}
    });
    
    // Function to update the pie chart based on the selected date
    function updatePieChart() {
      const selectedDate = document.getElementById('assessmentDateDropdown').value;
      const allScores = {
        {% for score in all_scores %}
          '{{ score.date }}': {
            depression: {{ score.depression }},
            anxiety: {{ score.anxiety }},
            stress: {{ score.stress }},
            severity: {
              depression: '{{ score.severity.depression }}',
              anxiety: '{{ score.severity.anxiety }}',
              stress: '{{ score.severity.stress }}',
            }
          },
        {% endfor %}
        'latest': {
          depression: {{ scores.depression|default:0 }},
          anxiety: {{ scores.anxiety|default:0 }},
          stress: {{ scores.stress|default:0 }},
          severity: {
            depression: '{{ severity.depression }}',
            anxiety: '{{ severity.anxiety }}',
            stress: '{{ severity.stress }}',
          }
        }
      };
    
      const selectedScore = allScores[selectedDate] || allScores['latest']; // Fallback to latest if selectedDate is not found
    
      // Update the pie chart data
      const depression = selectedScore.depression || 0; // Default to 0 if 
      const anxiety = selectedScore.anxiety || 0; // Default to 0 if undefined
      const stress = selectedScore.stress || 0; // Default to 0 if undefined
    
      pieChart.data.datasets[0].data = [depression, anxiety, stress];
      pieChart.update();
    
      // Update the severity text
      document.getElementById('depressionSeverity').textContent = selectedScore.severity?.depression || 'N/A'; // Default to 'N/A' if undefined
      document.getElementById('anxietySeverity').textContent = selectedScore.severity?.anxiety || 'N/A'; // Default to 'N/A' if undefined
      document.getElementById('stressSeverity').textContent = selectedScore.severity?.stress || 'N/A'; // Default to 'N/A' if undefined
    }    
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Check for screen orientation changes
    function checkOrientation() {
        const rotatePrompt = document.getElementById('rotateDevicePrompt');
        const isMobile = window.innerWidth <= 800; // Check if the display width is 500px or less

        if (isMobile) {
            if (window.innerHeight > window.innerWidth) {
                // Portrait mode
                rotatePrompt.style.display = 'none'; // Show prompt in portrait mode
            } else {
                // Landscape mode
                rotatePrompt.style.display = 'flex'; // Hide prompt in landscape mode
            }
        } else {
            // If not mobile, hide the prompt
            rotatePrompt.style.display = 'none';
        }
    }

    // Initial check on load
    window.onload = checkOrientation;

    // Listen for orientation changes
    window.addEventListener('resize', checkOrientation);
</script>
</body>
</html>